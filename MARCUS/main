#include <iostream>
#include <string>
#include <locale.h>
#include <cstdlib>
#define FUNCIONARIOS 10
#define ALUNOS 10

using namespace std;

typedef struct
{
    char nome[50], usuario[50], email[50];
    int matricula, senha, telefone;
} Funcionario;

typedef struct
{
    char nome[50], email[50];
    int matricula, telefone, turmaSerie;
} Aluno;

//VETORES
Funcionario funcionariosCadastrados[FUNCIONARIOS];
int totalFuncionarios = 0;

Aluno alunosCadastrados[ALUNOS];
int totalAlunos = 0;


void carregarFuncionariosDeArquivo()
{
    FILE* arquivo = fopen("funcionarios.txt", "r");

        totalFuncionarios = 0;
        while (fscanf(arquivo, "%s %d %s %d %s %d\n",
                      funcionariosCadastrados[totalFuncionarios].nome,
                      &funcionariosCadastrados[totalFuncionarios].matricula,
                      funcionariosCadastrados[totalFuncionarios].email,
                      &funcionariosCadastrados[totalFuncionarios].telefone,
                      funcionariosCadastrados[totalFuncionarios].usuario,
                      &funcionariosCadastrados[totalFuncionarios].senha) != EOF)
        {
            totalFuncionarios++;
        }
        fclose(arquivo);
}

void fazerLogin()
{
    string nomeUsuario, senha;

    cout << "Login\n\n";
    cout << "Nome de Usuário: ";
    cin >> nomeUsuario;
    cout << "Senha: ";
    cin >> senha;

    bool loginValido = false;

    for (int i = 0; i < totalFuncionarios; i++)
    {
        if (nomeUsuario == funcionariosCadastrados[i].usuario && senha == to_string(funcionariosCadastrados[i].senha))
        {
            loginValido = true;
            cout << "Login bem-sucedido como " << funcionariosCadastrados[i].nome << ". Acesso concedido!\n" << endl;
            system("pause");
            //menuPrincipal();
            break;
        }
    }

    if (!loginValido)
    {
        cout << "Credenciais incorretas. Acesso negado!\n" << endl;
        system("pause");
        system("cls");
    }
}

void salvarFuncionariosEmArquivo()
{
    FILE* arquivo = fopen("funcionarios.txt", "w");

        for (int i = 0; i < totalFuncionarios; i++)
        {
            fprintf(arquivo, "%s %d %s %d %s %d\n",
                    funcionariosCadastrados[i].nome,
                    funcionariosCadastrados[i].matricula,
                    funcionariosCadastrados[i].email,
                    funcionariosCadastrados[i].telefone,
                    funcionariosCadastrados[i].usuario,
                    funcionariosCadastrados[i].senha);
        }
        fclose(arquivo);
}

void cadastrarFuncionario()
{
    Funcionario novoFuncionario;

    system("cls");
    cout << "\nCadastro de Funcionário\n\n";
    cout << "Informe o nome do funcionário: ";
    cin.ignore();
    cin.getline(novoFuncionario.nome, 50);
    bool matriculaExistente;

    do {
        cout << "Matrícula: ";
        cin >> novoFuncionario.matricula;

        matriculaExistente = false;

        for (int i = 0; i < totalFuncionarios; i++) {
            if (novoFuncionario.matricula == funcionariosCadastrados[i].matricula) {
                matriculaExistente = true;
                cout << "Matrícula já está em uso. Escolha outra matrícula." << endl;
                break;
            }
        }

    } while (matriculaExistente);


    cout << "Email: ";
    cin >> novoFuncionario.email;
    cout << "Telefone: ";
    cin >> novoFuncionario.telefone;
    cout << "Usuário: ";
    cin >> novoFuncionario.usuario;
    cout << "Senha: ";
    cin >> novoFuncionario.senha;

    funcionariosCadastrados[totalFuncionarios] = novoFuncionario;
    totalFuncionarios++;

    system("cls");
    cout << "\nFuncionário cadastrado com sucesso.\n";
    system("pause");
    system("cls");
    salvarFuncionariosEmArquivo();
}

int main()
{
    setlocale(LC_ALL, "Portuguese");
    carregarFuncionariosDeArquivo();
    int opcao;

    do
    {
        cout << "Sistema de Consulta e Reserva de Armários\n\n";
        cout << "[1] Entrar\n";
        cout << "[2] Cadastrar\n";
        cout << "[3] Sair\n";
        cout << "Escolha uma opção: ";
        cin >> opcao;

        switch (opcao)
        {
        case 1:
        {
            system("cls");
            fazerLogin();
            break;
        }
        case 2:
            system("cls");
            cadastrarFuncionario();
            main();
            break;
        case 3:
            system("cls");
            cout << "Até logo.\n";
            break;
        default:
            system("cls");
            cout << "Opção inválida. Por favor, escolha novamente.\n" << endl;
            system("pause");
            system("cls");
            break;
        }
    }
    while(opcao!=3);

    return 0;
}
